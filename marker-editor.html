<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Marker Editor</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body {
      margin: 0;
      display: flex;
      height: 100vh;
    }
    #map {
      flex: 2;
    }
    #sidebar {
      flex: 1;
      padding: 10px;
      border-left: 1px solid #ccc;
      overflow-y: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 5px;
      text-align: left;
    }
    input, button {
      margin: 5px 0;
      width: 100%;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div id="sidebar">
    <h3>Add Marker</h3>
    <label>Name: <input type="text" id="name"></label><br>
    <label>Latitude: <input type="text" id="lat"></label><br>
    <label>Longitude: <input type="text" id="lng"></label><br>
    <label>URL: <input type="text" id="url"></label><br>
    <button onclick="addMarker()">Add Marker</button>

    <h3>Current Markers</h3>
    <table id="markerTable">
      <thead>
        <tr>
          <th>Name</th>
          <th>Latitude</th>
          <th>Longitude</th>
          <th>URL</th>
          <th>Delete</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    let map = L.map('map').setView([-20.2762, 148.7550], 10); // Whitsundays center
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    let markers = [];

    // Clicking the map pre-populates the lat/lng fields
    map.on('click', function(e) {
      document.getElementById('lat').value = e.latlng.lat.toFixed(6);
      document.getElementById('lng').value = e.latlng.lng.toFixed(6);
    });

    function refreshTable() {
      const tbody = document.querySelector('#markerTable tbody');
      tbody.innerHTML = '';
      markers.forEach((m, index) => {
        const row = `<tr>
          <td>${m.name}</td>
          <td>${m.lat}</td>
          <td>${m.lng}</td>
          <td><a href="${m.url}" target="_blank">View</a></td>
          <td><button onclick="deleteMarker(${index})">Delete</button></td>
        </tr>`;
        tbody.innerHTML += row;
      });
    }

    function addMarker() {
      const name = document.getElementById('name').value;
      const lat = document.getElementById('lat').value;
      const lng = document.getElementById('lng').value;
      const url = document.getElementById('url').value;

      if (!name || !lat || !lng || !url) {
        alert('Please fill all fields');
        return;
      }

      const newMarker = {
        name,
        lat: parseFloat(lat),
        lng: parseFloat(lng),
        url   // ✅ standardized field
      };

      markers.push(newMarker);
      L.marker([lat, lng]).addTo(map).bindPopup(`<b>${name}</b><br><a href="${url}" target="_blank">View</a>`);
      refreshTable();

      // Clear inputs
      document.getElementById('name').value = '';
      document.getElementById('lat').value = '';
      document.getElementById('lng').value = '';
      document.getElementById('url').value = '';
    }

    function deleteMarker(index) {
      markers.splice(index, 1);
      map.eachLayer(layer => {
        if (layer instanceof L.Marker) {
          map.removeLayer(layer);
        }
      });
      // re-add all markers
      markers.forEach(m => {
        L.marker([m.lat, m.lng]).addTo(map).bindPopup(`<b>${m.name}</b><br><a href="${m.url}" target="_blank">View</a>`);
      });
      refreshTable();
    }

    refreshTable();
  </script>
</body>
</html>
